<!DOCTYPE html>
<html>
<head>
    <title>BPMN Схема</title>
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@14/dist/assets/bpmn-js.css">
    <script src="https://unpkg.com/bpmn-js@14/dist/bpmn-navigated-viewer.development.js"></script>
    <style>
        html, body { margin:0; padding:0; height:100%; width:100%; overflow:hidden; }
        #canvas { width:100%; height:100%; background:#f8f8f8; }
        #controls {
            position: absolute; top:15px; left:15px;
            background:white; padding:10px; border-radius:5px;
            box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:100;
        }
        button { margin:0 5px; padding:8px 12px; cursor:pointer; }
    </style>
</head>
<body>
    <div id="canvas"></div>
    <div id="controls">
        <button onclick="zoom(0.2)">+ Увеличить</button>
        <button onclick="zoom(-0.2)">- Уменьшить</button>
        <button onclick="reset()">Сбросить вид</button>
        <button onclick="document.documentElement.requestFullscreen()">На весь экран</button>
    </div>
    <script>
        let viewer = new BpmnJS({ container: '#canvas' });
        const url = new URLSearchParams(window.location.search);
        const file = url.get('diagram') || 'diagram.bpmn';
        fetch(file)
            .then(r => r.ok ? r.text() : Promise.reject('Файл не найден'))
            .then(xml => viewer.importXML(xml))
            .then(() => viewer.get('canvas').zoom('fit-viewport'))
            .catch(e => document.getElementById('canvas').innerHTML = '<div style="padding:20px;color:red">Ошибка: ' + e + '</div>');
        function zoom(s) { viewer.get('zoomScroll').stepZoom(s); }
        function reset() { viewer.get('canvas').zoom('fit-viewport'); }
    </script>
</body>
</html>
