<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPMN Viewer - Просмотрщик схем</title>
    
    <!-- Библиотеки (версии 2026 года) -->
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@15.0.0/dist/assets/bpmn-js.css">
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@15.0.0/dist/assets/diagram-js.css">
    <script src="https://unpkg.com/bpmn-js@15.0.0/dist/bpmn-viewer.production.min.js"></script>
    
    <style>
        :root {
            --primary: #4285f4;
            --primary-dark: #3367d6;
            --surface: #ffffff;
            --surface-2: #f8f9fa;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            touch-action: none;
        }

        /* Основной контейнер */
        #app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Шапка */
        .header {
            padding: 16px 24px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Контейнер схемы */
        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: var(--surface);
            cursor: grab;
            transition: background 0.3s ease;
        }

        .canvas-container.dragging {
            cursor: grabbing;
            user-select: none;
        }

        .canvas-container.loading {
            background: linear-gradient(90deg, var(--surface) 0%, var(--surface-2) 50%, var(--surface) 100%);
            background-size: 200% 200%;
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        #canvas {
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.15s ease-out;
        }

        /* Панель управления */
        .controls {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            padding: 12px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn {
            width: 44px;
            height: 44px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .control-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.3s ease, opacity 0.2s ease;
            border-radius: 50%;
        }

        .control-btn:hover {
            border-color: var(--primary);
            background: rgba(66, 133, 244, 0.04);
            transform: translateY(-1px);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn:hover::after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.1;
        }

        .control-btn:active::after {
            transform: translate(-50%, -50%) scale(0.9);
            opacity: 0.2;
        }

        .zoom-controls {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin: 0 8px;
        }

        .zoom-display {
            min-width: 80px;
            padding: 8px 12px;
            background: var(--surface-2);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .zoom-percent {
            font-weight: 600;
            color: var(--primary);
            min-width: 48px;
            text-align: center;
        }

        /* Статус загрузки */
        .status-bar {
            position: fixed;
            top: 12px;
            right: 12px;
            background: var(--surface);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
        }

        .status-bar.show {
            opacity: 1;
            transform: translateY(0);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34a853;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Сетка для ориентации */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .canvas-container.show-grid .grid-overlay {
            opacity: 1;
        }

        /* Подсказки */
        .hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            padding: 12px 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            z-index: 90;
            opacity: 0;
            animation: fadeInOut 4s ease-in-out;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            20%, 80% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .controls {
                bottom: 16px;
                padding: 8px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .zoom-display {
                min-width: 70px;
                padding: 6px 10px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .controls {
                gap: 4px;
            }
            
            .zoom-controls {
                margin: 0 4px;
            }
            
            .control-btn {
                width: 36px;
                height: 36px;
            }
            
            .hint {
                width: 90%;
                bottom: 80px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Шапка -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">BPMN</div>
                <span>Просмотрщик схем</span>
            </div>
            <div class="status-bar" id="statusBar">
                <div class="status-dot"></div>
                <span id="statusText">Загрузка...</span>
            </div>
        </div>

        <!-- Основной контейнер схемы -->
        <div class="canvas-container" id="canvasContainer">
            <div class="grid-overlay"></div>
            <div id="canvas"></div>
        </div>

        <!-- Панель управления -->
        <div class="controls">
            <button class="control-btn" onclick="zoomOut()" title="Уменьшить (Ctrl - / Колесо вниз)">−</button>
            
            <div class="zoom-controls">
                <button class="control-btn" onclick="zoomIn()" title="Увеличить (Ctrl + / Колесо вверх)">+</button>
                
                <div class="zoom-display">
                    <span>Масштаб:</span>
                    <span class="zoom-percent" id="zoomLevel">100%</span>
                </div>
                
                <button class="control-btn" onclick="resetView()" title="Сбросить вид (0)">↺</button>
            </div>
            
            <button class="control-btn" onclick="toggleFullscreen()" title="Полный экран (F11)">⛶</button>
            <button class="control-btn" onclick="toggleGrid()" title="Показать сетку (G)">#</button>
            <button class="control-btn" onclick="centerView()" title="Центрировать (C)">◎</button>
        </div>

        <!-- Подсказки -->
        <div class="hint" id="hint"></div>
    </div>

    <script>
        // ===== КОНФИГУРАЦИЯ (2026 год) =====
        const CONFIG = {
            defaultDiagram: '1zayavka.bpmn',
            zoom: {
                min: 0.02,     // 2%
                max: 20,       // 2000%
                step: 0.15,    // 15% за шаг
                smoothness: 0.9, // Плавность анимации (0-1)
                wheelMultiplier: 0.001 // Множитель колесика
            },
            drag: {
                sensitivity: 1.2,
                inertia: 0.85  // Инерция при перетаскивании
            },
            animation: {
                duration: 250, // мс
                easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
            },
            features: {
                showGrid: false,
                smoothScroll: true,
                inertialScroll: true
            }
        };

        // ===== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ =====
        let viewer = null;
        let canvas = null;
        let currentZoom = 1;
        let viewbox = { x: 0, y: 0, width: 0, height: 0 };
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let velocity = { x: 0, y: 0 };
        let lastTimestamp = 0;
        let animationFrame = null;

        // ===== ИНИЦИАЛИЗАЦИЯ =====
        async function initialize() {
            showStatus('Инициализация...', 'loading');
            
            try {
                // Создаем просмотрщик
                viewer = new BpmnJS({
                    container: '#canvas',
                    keyboard: { bindTo: document },
                    additionalModules: []
                });
                
                canvas = viewer.get('canvas');
                
                // Настраиваем события
                setupEventListeners();
                setupViewboxObserver();
                
                // Загружаем схему из URL или по умолчанию
                await loadDiagram();
                
                showStatus('Готово', 'success');
                showHint('Используйте колесо мыши для масштабирования');
                
            } catch (error) {
                showStatus('Ошибка загрузки', 'error');
                console.error('Ошибка инициализации:', error);
            }
        }

        // ===== ЗАГРУЗКА СХЕМЫ =====
        async function loadDiagram() {
            try {
                showStatus('Загрузка схемы...', 'loading');
                
                // Получаем имя файла из URL
                const urlParams = new URLSearchParams(window.location.search);
                let diagramUrl = urlParams.get('diagram') || CONFIG.defaultDiagram;
                
                // Поддержка ссылок на GitHub raw
                if (diagramUrl.includes('github.com')) {
                    diagramUrl = diagramUrl
                        .replace('github.com', 'raw.githubusercontent.com')
                        .replace('/blob/', '/');
                }
                
                // Загружаем XML
                const response = await fetch(diagramUrl, {
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const xml = await response.text();
                
                // Импортируем в просмотрщик
                await viewer.importXML(xml);
                
                // Устанавливаем начальный вид
                setTimeout(() => {
                    resetView();
                    updateViewbox();
                }, 100);
                
            } catch (error) {
                console.error('Ошибка загрузки схемы:', error);
                showStatus(`Ошибка: ${error.message}`, 'error');
                throw error;
            }
        }

        // ===== МАСШТАБИРОВАНИЕ ОТНОСИТЕЛЬНО КУРСОРА (Google Maps-style) =====
        function handleWheel(event) {
            event.preventDefault();
            
            const container = document.getElementById('canvasContainer');
            const rect = container.getBoundingClientRect();
            
            // Координаты курсора относительно контейнера
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;
            
            // Координаты курсора в системе схемы
            const diagramX = viewbox.x + (mouseX / currentZoom);
            const diagramY = viewbox.y + (mouseY / currentZoom);
            
            // Определяем направление и силу зума
            const delta = event.deltaY || event.deltaX || event.detail;
            const zoomDirection = delta > 0 ? -1 : 1;
            
            // Вычисляем коэффициент зума с учетом скорости прокрутки
            const zoomFactor = 1 + (zoomDirection * CONFIG.zoom.step * 
                (event.deltaMode === 0 ? CONFIG.zoom.wheelMultiplier : 0.1));
            
            // Новый масштаб
            let newZoom = currentZoom * zoomFactor;
            newZoom = Math.max(CONFIG.zoom.min, Math.min(CONFIG.zoom.max, newZoom));
            
            // Вычисляем новые координаты viewbox
            const newViewboxX = diagramX - (mouseX / newZoom);
            const newViewboxY = diagramY - (mouseY / newZoom);
            
            // Плавный переход к новому виду
            smoothZoomTo(newZoom, newViewboxX, newViewboxY);
        }

        // ===== ПЛАВНЫЙ ЗУМ С АНИМАЦИЕЙ =====
        function smoothZoomTo(targetZoom, targetX, targetY) {
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
            
            const startZoom = currentZoom;
            const startX = viewbox.x;
            const startY = viewbox.y;
            const startTime = performance.now();
            
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / CONFIG.animation.duration, 1);
                
                // Кривая плавности
                const ease = CONFIG.features.smoothScroll ? 
                    easeOutCubic(progress) : progress;
                
                // Интерполируем значения
                currentZoom = startZoom + (targetZoom - startZoom) * ease;
                viewbox.x = startX + (targetX - startX) * ease;
                viewbox.y = startY + (targetY - startY) * ease;
                
                // Применяем к канвасу
                canvas.viewbox({
                    x: viewbox.x,
                    y: viewbox.y,
                    width: viewbox.width,
                    height: viewbox.height
                });
                canvas.zoom(currentZoom);
                
                // Обновляем UI
                updateZoomIndicator();
                updateViewbox();
                
                if (progress < 1) {
                    animationFrame = requestAnimationFrame(animate);
                } else {
                    animationFrame = null;
                }
            }
            
            animationFrame = requestAnimationFrame(animate);
        }

        // ===== ПЕРЕТАСКИВАНИЕ С ИНЕРЦИЕЙ =====
        function startDrag(event) {
            if (event.button !== 0) return; // Только левая кнопка
            
            isDragging = true;
            const container = document.getElementById('canvasContainer');
            container.classList.add('dragging');
            
            dragStart = { x: event.clientX, y: event.clientY };
            velocity = { x: 0, y: 0 };
            lastTimestamp = performance.now();
            
            event.preventDefault();
        }

        function doDrag(event) {
            if (!isDragging) return;
            
            const now = performance.now();
            const deltaTime = now - lastTimestamp;
            
            // Вычисляем смещение
            const dx = (event.clientX - dragStart.x) / currentZoom * CONFIG.drag.sensitivity;
            const dy = (event.clientY - dragStart.y) / currentZoom * CONFIG.drag.sensitivity;
            
            // Обновляем viewbox
            viewbox.x -= dx;
            viewbox.y -= dy;
            
            // Вычисляем скорость для инерции
            if (deltaTime > 0) {
                velocity.x = dx / deltaTime;
                velocity.y = dy / deltaTime;
            }
            
            // Применяем изменения
            canvas.viewbox({
                x: viewbox.x,
                y: viewbox.y,
                width: viewbox.width,
                height: viewbox.height
            });
            
            // Обновляем стартовую позицию
            dragStart = { x: event.clientX, y: event.clientY };
            lastTimestamp = now;
            
            event.preventDefault();
        }

        function endDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            document.getElementById('canvasContainer').classList.remove('dragging');
            
            // Применяем инерцию, если включено
            if (CONFIG.features.inertialScroll && (velocity.x !== 0 || velocity.y !== 0)) {
                applyInertia();
            }
        }

        function applyInertia() {
            let lastTime = performance.now();
            
            function animateInertia(currentTime) {
                const deltaTime = currentTime - lastTime;
                
                // Уменьшаем скорость с каждым кадром
                velocity.x *= Math.pow(CONFIG.drag.inertia, deltaTime / 16);
                velocity.y *= Math.pow(CONFIG.drag.inertia, deltaTime / 16);
                
                // Если скорость слишком мала - останавливаем
                if (Math.abs(velocity.x) < 0.01 && Math.abs(velocity.y) < 0.01) {
                    return;
                }
                
                // Применяем инерцию к viewbox
                viewbox.x -= velocity.x * deltaTime;
                viewbox.y -= velocity.y * deltaTime;
                
                canvas.viewbox({
                    x: viewbox.x,
                    y: viewbox.y,
                    width: viewbox.width,
                    height: viewbox.height
                });
                
                lastTime = currentTime;
                requestAnimationFrame(animateInertia);
            }
            
            requestAnimationFrame(animateInertia);
        }

        // ===== УПРАВЛЕНИЕ =====
        function zoomIn() {
            zoomAtPoint(CONFIG.zoom.step, 
                window.innerWidth / 2, 
                window.innerHeight / 2);
        }

        function zoomOut() {
            zoomAtPoint(-CONFIG.zoom.step, 
                window.innerWidth / 2, 
                window.innerHeight / 2);
        }

        function zoomAtPoint(zoomDelta, clientX, clientY) {
            const container = document.getElementById('canvasContainer');
            const rect = container.getBoundingClientRect();
            
            const mouseX = clientX - rect.left;
            const mouseY = clientY - rect.top;
            
            const diagramX = viewbox.x + (mouseX / currentZoom);
            const diagramY = viewbox.y + (mouseY / currentZoom);
            
            const targetZoom = currentZoom * (1 + zoomDelta);
            const newZoom = Math.max(CONFIG.zoom.min, 
                Math.min(CONFIG.zoom.max, targetZoom));
            
            const newViewboxX = diagramX - (mouseX / newZoom);
            const newViewboxY = diagramY - (mouseY / newZoom);
            
            smoothZoomTo(newZoom, newViewboxX, newViewboxY);
        }

        function resetView() {
            canvas.zoom('fit-viewport', { padding: 50 });
            currentZoom = canvas.zoom();
            viewbox = canvas.viewbox();
            updateZoomIndicator();
        }

        function centerView() {
            canvas.viewbox({
                x: -viewbox.width / 4,
                y: -viewbox.height / 4,
                width: viewbox.width,
                height: viewbox.height
            });
            updateViewbox();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function toggleGrid() {
            CONFIG.features.showGrid = !CONFIG.features.showGrid;
            const container = document.getElementById('canvasContainer');
            container.classList.toggle('show-grid', CONFIG.features.showGrid);
            
            showHint(CONFIG.features.showGrid ? 
                'Сетка включена' : 'Сетка выключена');
        }

        // ===== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ =====
        function setupEventListeners() {
            const container = document.getElementById('canvasContainer');
            
            // Колесико мыши
            container.addEventListener('wheel', handleWheel, { passive: false });
            
            // Перетаскивание
            container.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', doDrag);
            document.addEventListener('mouseup', endDrag);
            
            // Касания (для мобильных)
            container.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    startDrag({ 
                        button: 0, 
                        clientX: e.touches[0].clientX, 
                        clientY: e.touches[0].clientY 
                    });
                }
                e.preventDefault();
            }, { passive: false });
            
            container.addEventListener('touchmove', (e) => {
                if (e.touches.length === 1) {
                    doDrag({ 
                        clientX: e.touches[0].clientX, 
                        clientY: e.touches[0].clientY 
                    });
                }
                e.preventDefault();
            }, { passive: false });
            
            container.addEventListener('touchend', endDrag);
            
            // Горячие клавиши
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + колесо
                if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
                    if (e.key === '+' || e.key === '=') {
                        e.preventDefault();
                        zoomIn();
                    } else if (e.key === '-') {
                        e.preventDefault();
                        zoomOut();
                    }
                }
                
                // Одиночные клавиши
                if (!e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey) {
                    switch (e.key) {
                        case '0':
                            e.preventDefault();
                            resetView();
                            break;
                        case 'g':
                        case 'G':
                            e.preventDefault();
                            toggleGrid();
                            break;
                        case 'c':
                        case 'C':
                            e.preventDefault();
                            centerView();
                            break;
                        case 'f':
                        case 'F':
                            if (e.key === 'f' || e.key === 'F') {
                                e.preventDefault();
                                toggleFullscreen();
                            }
                            break;
                    }
                }
            });
            
            // Изменение размера окна
            window.addEventListener('resize', () => {
                updateViewbox();
            });
            
            // Полноэкранный режим
            document.addEventListener('fullscreenchange', () => {
                setTimeout(updateViewbox, 100);
            });
        }

        function setupViewboxObserver() {
            // Обновляем viewbox при изменениях
            const originalViewbox = canvas.viewbox;
            canvas.viewbox = function(...args) {
                const result = originalViewbox.apply(this, args);
                if (args.length === 0) {
                    return result;
                }
                updateViewbox();
                return result;
            };
        }

        function updateViewbox() {
            if (!canvas) return;
            viewbox = canvas.viewbox();
            currentZoom = canvas.zoom();
        }

        function updateZoomIndicator() {
            const zoomPercent = Math.round(currentZoom * 100);
            document.getElementById('zoomLevel').textContent = `${zoomPercent}%`;
        }

        function showStatus(message, type = 'info') {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = message;
            statusBar.classList.add('show');
            
            const dot = statusBar.querySelector('.status-dot');
            dot.style.background = type === 'success' ? '#34a853' :
                                 type === 'error' ? '#ea4335' :
                                 type === 'loading' ? '#4285f4' :
                                 '#5f6368';
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusBar.classList.remove('show');
                }, 3000);
            }
        }

        function showHint(message) {
            const hint = document.getElementById('hint');
            hint.textContent = message;
            hint.style.animation = 'none';
            void hint.offsetHeight; // Рефлоу
            hint.style.animation = 'fadeInOut 4s ease-in-out';
        }

        // ===== МАТЕМАТИЧЕСКИЕ ФУНКЦИИ =====
        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // ===== ЗАПУСК ПРИЛОЖЕНИЯ =====
        document.addEventListener('DOMContentLoaded', () => {
            // Проверяем поддержку всех функций
            if (!('requestAnimationFrame' in window)) {
                alert('Ваш браузер устарел. Пожалуйста, обновите его.');
                return;
            }
            
            // Инициализируем приложение
            initialize();
        });

        // Защита от случайного закрытия
        window.addEventListener('beforeunload', (e) => {
            if (isDragging) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
